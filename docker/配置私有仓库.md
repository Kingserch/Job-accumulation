+ ### 配置私有仓库 
    + [仓库](#仓库)
    + [坑位](#坑位)
    + [坑位](#坑位)
    + [坑位](#坑位)
+ ### 仓库
1.安装Dcoker Registry,基于容器安装  
`docker run -d -p 5000:5000 --restart=always --name registry registry:2`  
2.本地安装运行
```
yum install -y epel-release	
yum install golang -y
go version
go version go1.13.3 linux/amd64
mkdir -p $GOPATH/src/github.com/docker/	
cd $GOPATH/src/github.com/docker/
git clone https://github.com/docker/distribution.git	
```
3.配置TLS证书
```
[root@m129 ~]# docker tag centos:7 registry:5000/centos:7	#本地的centos镜像上传到仓库
[root@m129 ~]# docker push registry:5000/centos:7	#推到仓库
[root@m129 ~]# mkdir -p certs	#创建存放TLS证书的目录
[root@m129 ~]# openssl req -newkey rsa:4096 -nodes -sha256 -keyout certs/repo.key -x509 -days 365 -out certs/repo.crt
Generating a 4096 bit RSA private key
...................................++
.....................................................................................................................++
writing new private key to 'certs/repo.key'
-----
You are about to be asked to enter information that will be incorporated
into your certificate request.
What you are about to enter is what is called a Distinguished Name or a DN.
There are quite a few fields but you can leave some blank
For some fields there will be a default value,
If you enter '.', the field will be left blank.
-----
Country Name (2 letter code) [XX]:ki	#国家名称
State or Province Name (full name) []:henan	#省
Locality Name (eg, city) [Default City]:zz	#地区城市
Organization Name (eg, company) [Default Company Ltd]:sj	#公司
Organizational Unit Name (eg, section) []:yw	#职位
Common Name (eg, your name or your server's hostname) []:192.168.10.129	#服务器名称或者ip
Email Address []:2249155086@qq.com	#邮箱
[root@m129 ~]# cd certs/
[root@m129 certs]# ls
repo.crt  repo.key	#秘钥文件repo.key，证书文件repo.crt，这个文件是需要发给用户，配置到用户docker hosts上，
[root@m129 certs]# docker run -d --restart=always --name registry -v 'pwd'/certs:/certs -e REGISTRY_HTTP_ADDR=0.0.0.0:443 -e REGISTRY_HTTP_TLS_CERTIFICATE=/root/certs/repo.crt -e REGISTRY_HTTP_TLS_KEY=/root/certs/repo.key -p 443:443
#上命令是启动证书
```
4.管理访问权限
具体交互过程包括如下步骤：
* Docker Daemon或者其他客户端尝试访问Registry服务器，比如pull、push或者访问manifiest文件；
* 在Registry服务器开启了认证服务模式时，就会直接返回401 Unauthorized错误，并通知调用方如何获得授权；
* 调用方按照要求，向Authorization Service发送请求，并携带Authorization Service需要的信息，比如用户名、密码；
* 如果授权成功，则可以拿到合法的Bearer token，来标识该请求方可以获得的权限；
* 请求方将拿到Bearer token加到请求的Authorization header中，再次尝试步骤1中的请求；
* Registry服务通过验证Bearer token以及JWT格式的授权数据，来决定用户是否有权限进行请求的操作。
配置nginx代理


